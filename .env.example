# Whisper Transcription API - Environment Configuration
# Copy this file to .env and fill in your actual values

# =============================================================================
# SERVER CONFIGURATION
# =============================================================================
PORT=3000
NODE_ENV=development

# =============================================================================
# DATABASE
# =============================================================================
# PostgreSQL connection string
# Format: postgresql://USERNAME:PASSWORD@HOST:PORT/DATABASE
DATABASE_URL="postgresql://user:password@localhost:5432/whisperapi"

# =============================================================================
# REDIS (Job Queue)
# =============================================================================
# Redis connection string for BullMQ job queue
REDIS_URL="redis://localhost:6379"

# =============================================================================
# S3 / CLOUDFLARE R2 (File Storage)
# =============================================================================
# S3-compatible object storage for audio files and transcription results

# Bucket name (create this in your S3/R2 dashboard)
S3_BUCKET="whisper-audio"

# AWS region (not used for R2, but required by SDK)
S3_REGION="us-east-1"

# Access credentials
S3_ACCESS_KEY="your-access-key-id"
S3_SECRET_KEY="your-secret-access-key"

# Optional: Custom endpoint for Cloudflare R2
# Leave empty for AWS S3, or set to your R2 endpoint
# Example: https://abc123.r2.cloudflarestorage.com
S3_ENDPOINT=""

# =============================================================================
# WORKER CONFIGURATION - KEY TOGGLE POINT
# =============================================================================
# Toggle between local Mac Mini processing or cloud GPU processing
# Change WORKER_MODE and restart the server - no code changes needed!

# Mode: "local" (Mac Mini) or "cloud" (Modal/RunPod)
WORKER_MODE="local"

# Local worker URL (Tailscale IP recommended for security)
# Example: http://100.64.1.2:3001
LOCAL_WORKER_URL="http://100.x.x.x:3001"

# Cloud worker URL (Modal, RunPod, or custom deployment)
# Example: https://your-app--whisper-worker.modal.run
CLOUD_WORKER_URL=""

# =============================================================================
# STRIPE (Payments)
# =============================================================================
# Get these from: https://dashboard.stripe.com/apikeys

# Secret key (use sk_test_* for development, sk_live_* for production)
STRIPE_SECRET_KEY="sk_test_51xxxxxxxxxxxxx"

# Webhook signing secret (from webhook endpoint settings)
STRIPE_WEBHOOK_SECRET="whsec_xxxxxxxxxxxxx"

# Pro plan price ID (from Stripe Products)
STRIPE_PRICE_ID_PRO="price_xxxxxxxxxxxxx"

# =============================================================================
# API KEY CONFIGURATION
# =============================================================================
# API key format: wtr_live_[32 random characters]
API_KEY_PREFIX="wtr_live_"
API_KEY_LENGTH=32

# =============================================================================
# RATE LIMITS (Requests per Hour)
# =============================================================================
# How many transcription requests each plan tier can make per hour

RATE_LIMIT_FREE=3      # Free tier: 3 requests/hour
RATE_LIMIT_PRO=20      # Pro tier: 20 requests/hour
RATE_LIMIT_PAYG=100    # Pay-as-you-go: 100 requests/hour

# =============================================================================
# MONTHLY QUOTAS (Minutes)
# =============================================================================
# Total audio minutes each plan can transcribe per month
# PAYG has no limit (charged per minute)

QUOTA_FREE=60          # Free tier: 60 minutes/month
QUOTA_PRO=600          # Pro tier: 600 minutes/month (10 hours)

# =============================================================================
# FILE CONFIGURATION
# =============================================================================
# Maximum upload file size in megabytes
MAX_FILE_SIZE_MB=500

# Allowed audio file formats (comma-separated, no spaces)
# Common formats: mp3,wav,m4a,mp4,mpeg,webm,ogg,flac
ALLOWED_FORMATS="mp3,wav,m4a,mp4,mpeg,webm"

# How long to keep files in S3 before cleanup (hours)
FILE_RETENTION_HOURS=24

# =============================================================================
# CORS CONFIGURATION (Optional)
# =============================================================================
# Allowed origins for CORS (* for all, or specific domains)
# CORS_ORIGIN="https://yourdomain.com"
# CORS_CREDENTIALS=true

# =============================================================================
# QUICK START CHECKLIST
# =============================================================================
# [ ] 1. Copy this file: cp .env.example .env
# [ ] 2. Set DATABASE_URL with your PostgreSQL credentials
# [ ] 3. Set S3 credentials (S3_BUCKET, S3_ACCESS_KEY, S3_SECRET_KEY)
# [ ] 4. Set Stripe keys (STRIPE_SECRET_KEY, STRIPE_WEBHOOK_SECRET, STRIPE_PRICE_ID_PRO)
# [ ] 5. Choose WORKER_MODE (local or cloud)
# [ ] 6. Set appropriate worker URL (LOCAL_WORKER_URL or CLOUD_WORKER_URL)
# [ ] 7. Run: npm run dev
# [ ] 8. Check for validation errors in console

# =============================================================================
# SWITCHING BETWEEN LOCAL AND CLOUD WORKERS
# =============================================================================
# To switch from local Mac Mini to cloud processing:
#   1. Change: WORKER_MODE="cloud"
#   2. Ensure: CLOUD_WORKER_URL is set
#   3. Restart: npm restart (or pm2 restart)
#   4. Takes ~30 seconds, no code changes needed!
#
# To switch back:
#   1. Change: WORKER_MODE="local"
#   2. Restart server
#
# The system automatically routes transcription jobs to the active worker.

# =============================================================================
# SECURITY NOTES
# =============================================================================
# - NEVER commit .env to git (already in .gitignore)
# - Use strong, unique credentials for production
# - Rotate secrets regularly
# - Use Tailscale or VPN for local worker security
# - Enable HTTPS in production (enforced by validation)
# - Keep S3 buckets private (use presigned URLs)

# =============================================================================
# PRODUCTION RECOMMENDATIONS
# =============================================================================
# When deploying to production:
# - Set NODE_ENV=production
# - Use sk_live_* Stripe keys (not sk_test_*)
# - Use managed PostgreSQL (Railway, Supabase, etc.)
# - Use managed Redis (Upstash, Redis Cloud, etc.)
# - Set WORKER_MODE=cloud for reliability
# - Enable proper CORS_ORIGIN restrictions
# - Monitor logs for validation warnings

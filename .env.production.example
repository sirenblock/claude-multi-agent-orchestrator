# Whisper Transcription API - Production Environment Configuration
# This file contains production-ready defaults and security best practices

# =============================================================================
# SERVER CONFIGURATION
# =============================================================================
PORT=3000
NODE_ENV=production

# =============================================================================
# DATABASE (Managed PostgreSQL Recommended)
# =============================================================================
# Use managed PostgreSQL from Railway, Supabase, or similar
# Format: postgresql://USERNAME:PASSWORD@HOST:PORT/DATABASE?sslmode=require
DATABASE_URL="postgresql://user:password@prod-db.railway.app:5432/whisperapi?sslmode=require"

# =============================================================================
# REDIS (Managed Redis Recommended)
# =============================================================================
# Use Upstash, Redis Cloud, or similar for production reliability
# Format with TLS: rediss://default:password@redis-host:6379
REDIS_URL="rediss://default:password@prod-redis.upstash.io:6379"

# =============================================================================
# S3 / CLOUDFLARE R2 (Production Storage)
# =============================================================================
# Production bucket - separate from development!
S3_BUCKET="whisper-audio-prod"
S3_REGION="us-east-1"
S3_ACCESS_KEY="PROD_ACCESS_KEY"
S3_SECRET_KEY="PROD_SECRET_KEY"

# Cloudflare R2 endpoint (recommended for cost savings)
S3_ENDPOINT="https://account-id.r2.cloudflarestorage.com"

# =============================================================================
# WORKER CONFIGURATION - PRODUCTION
# =============================================================================
# IMPORTANT: Use "cloud" mode for production reliability
# Cloud workers scale automatically and have better uptime

WORKER_MODE="cloud"

# Cloud worker URL (Modal recommended)
# Modal provides auto-scaling GPU workers with high availability
CLOUD_WORKER_URL="https://your-org--whisper-worker-prod.modal.run"

# Local worker (optional backup - requires VPN/Tailscale)
LOCAL_WORKER_URL=""

# =============================================================================
# STRIPE (PRODUCTION - LIVE KEYS)
# =============================================================================
# ⚠️ CRITICAL: Use sk_live_* keys for production!
# Get from: https://dashboard.stripe.com/apikeys

STRIPE_SECRET_KEY="sk_live_51xxxxxxxxxxxxx"
STRIPE_WEBHOOK_SECRET="whsec_xxxxxxxxxxxxx"
STRIPE_PRICE_ID_PRO="price_xxxxxxxxxxxxx"

# =============================================================================
# API KEY CONFIGURATION
# =============================================================================
API_KEY_PREFIX="wtr_live_"
API_KEY_LENGTH=32

# =============================================================================
# RATE LIMITS (Production Values)
# =============================================================================
# Conservative limits to prevent abuse
RATE_LIMIT_FREE=3
RATE_LIMIT_PRO=20
RATE_LIMIT_PAYG=100

# =============================================================================
# MONTHLY QUOTAS
# =============================================================================
QUOTA_FREE=60          # 1 hour/month
QUOTA_PRO=600          # 10 hours/month

# =============================================================================
# FILE CONFIGURATION (Production)
# =============================================================================
MAX_FILE_SIZE_MB=500
ALLOWED_FORMATS="mp3,wav,m4a,mp4,mpeg,webm"

# Shorter retention for production (save storage costs)
FILE_RETENTION_HOURS=24

# =============================================================================
# CORS CONFIGURATION (Production)
# =============================================================================
# ⚠️ IMPORTANT: Set specific domains, not "*"
CORS_ORIGIN="https://app.yourdomain.com,https://yourdomain.com"
CORS_CREDENTIALS=true

# =============================================================================
# MONITORING & LOGGING (Optional but Recommended)
# =============================================================================
# Uncomment and configure if using external monitoring

# Sentry for error tracking
# SENTRY_DSN="https://xxx@sentry.io/xxx"

# LogDNA/Datadog for log aggregation
# LOGDNA_API_KEY="xxx"

# =============================================================================
# PRODUCTION DEPLOYMENT CHECKLIST
# =============================================================================
# [ ] 1. All secrets rotated from development
# [ ] 2. DATABASE_URL points to production database with SSL
# [ ] 3. REDIS_URL points to managed Redis with TLS
# [ ] 4. S3_BUCKET is separate from development
# [ ] 5. STRIPE_SECRET_KEY is sk_live_* (not sk_test_*)
# [ ] 6. WORKER_MODE set to "cloud" for reliability
# [ ] 7. CORS_ORIGIN restricted to your domains
# [ ] 8. NODE_ENV=production
# [ ] 9. Secrets stored in Railway/Vercel environment variables
# [ ] 10. Webhook endpoints configured in Stripe dashboard
# [ ] 11. DNS records pointing to production deployment
# [ ] 12. SSL certificates active (auto with Railway/Vercel)

# =============================================================================
# SECURITY CHECKLIST
# =============================================================================
# [ ] All passwords are strong and unique
# [ ] Database requires SSL/TLS connections
# [ ] Redis requires TLS (rediss://)
# [ ] S3 bucket is private (not public)
# [ ] API rate limiting is enabled
# [ ] CORS is restricted to known domains
# [ ] Stripe webhook signature verification enabled
# [ ] No test/development keys in production
# [ ] Secrets managed via platform (not .env file)
# [ ] Regular security audits scheduled

# =============================================================================
# SCALING CONFIGURATION
# =============================================================================
# For high-traffic deployments, consider:
# - Increasing rate limits based on load testing
# - Using Redis cluster for queue scaling
# - Multiple worker instances for cloud mode
# - CDN for static assets
# - Database connection pooling

# =============================================================================
# BACKUP & DISASTER RECOVERY
# =============================================================================
# Ensure you have:
# [ ] Automated database backups (daily minimum)
# [ ] S3 bucket versioning enabled
# [ ] Monitoring alerts configured
# [ ] Documented rollback procedure
# [ ] Team access to all production secrets (securely)

# =============================================================================
# COST OPTIMIZATION
# =============================================================================
# Production cost-saving tips:
# - Use Cloudflare R2 instead of S3 (10x cheaper egress)
# - Set aggressive FILE_RETENTION_HOURS to auto-cleanup
# - Use Modal spot instances for workers when possible
# - Monitor and optimize database query performance
# - Consider caching frequent API responses

# =============================================================================
# ENVIRONMENT VARIABLES IN HOSTING PLATFORMS
# =============================================================================
# Don't use .env files in production! Use platform secrets:
#
# Railway:
#   railway variables set KEY=value
#
# Vercel:
#   vercel env add KEY (interactive)
#   or via dashboard: Settings > Environment Variables
#
# Heroku:
#   heroku config:set KEY=value
#
# Docker:
#   Pass via docker run -e KEY=value
#   or docker-compose.yml environment section

# =============================================================================
# SUPPORT CONTACTS
# =============================================================================
# Keep these handy for production issues:
# - Database provider support
# - Redis provider support
# - Stripe support: https://support.stripe.com
# - S3/R2 support
# - Worker platform (Modal) support
